Come si trasmettono le informazioni da un router all'altro fino agli endpoint è opera del livello \textit{datalink}. \\
Questo livello si appoggia sul concetto di \textit{trama}, un percorso seguito dal flusso, che inizia e finisce su due estremi. Offre diversi servizi:
\begin{itemize}
	\item rilevamento e correzioni di errori;
	\item condivisione di canali broadcast, offrendo accessi multipli;
	\item servizio di gestione degli indirizzi di livello link;
	\item trasnferimento dati affidabili, con controllo del flusso.
\end{itemize}
Il livello di rete è implementato sugli \textit{adaptor}, che comunicano l'uno con l'altro - stabilendo una trama per raggiungersi - e che devono rispettare gli standard appena esposti. \\
Accetta soltanto degli stream di raw bit (flussi di sequenze di bit) e cerca di consegnarlo a destinazione: ciononostante la comunicazione non è necessariamente priva di errori. Per gestire un numero multiplo di flussi di informazioni, divide lo stream in un numero variabile di trama (\textit{framing}) e elabora il checksum per ogni trama (per ovviare a problemi di generazione e correzione errori). \\
Lo split viene applicato ogni \textit{n} caratteri, e ciascun flusso è delimitato da dei caratteri speciali: \textit{DLE STX} (\textit{Data Link Escape Start of TeXt}) e DLE ETX (\textit{Data Link Escape End of TeXt}). Qualora dovesse essere inviata esattamente la stringa utilizzata come escape, viene aggiunto un \textit{DLE} per eliminare ambiguità. \\
Possono essere poi utilizzati degli approcci meno generici, come il sistema \textit{Manchester}.

\section{Rilevamento di errori}
Tra i dati trasmessi, vi sono due blocchi fondamentali:
\begin{enumerate}
	\item \textit{EDC}: bit - ridondanti - di \textit{error detection and correction};
	\item \textit{D}: dati protetti dal controllo di errori - eventualmente accompagnati da campi header.
\end{enumerate}
Ovviamente la rilevamento di errori non è affidabile al 100\%: si potrebbero raramente non rilevare alcuni errori, in maniera inversamente proporzionale alla dimensione alla dimensione dell'\textit{EDC} utilizzata. \\
Nel rilevamento di errori, si utilizza il calcolo della distanza di \textit{Hamming}, attraverso cui è possibile determinare in quanti bit differiscano due parole di codice. Sostanzialmente, si esegue lo \textit{XOR} tra le parole e poi si conta il numero di 1 nel risultato: il numero di posizioni nelle quali le due parole di codice differiscono determina la loro distanza di \textit{Hamming}. Se due parole hanno distanza di \textit{Hamming} \textit{d}, ci vorranno \textit{d} operazioni sui singoli bit per tramutare una parola di codice nell'altra: per come sono utilizzati i bit di ridonanza, se la lunghezza delle parole di codice è $n=m+4$, sono possibili $2^m$ messaggi dati validi, ma non tutte le $2^n$ parole di codice. Dunque la distanza di \textit{Hamming} di un codice è la minima distanza di \textit{Hamming} tra le due parole di codice. Ancora, per rilevare \textit{d} errori occorre un codice con distanza di \textit{Hamming} $d+1$, mentre per correggerli serve un codice con distanza di \textit{Hamming} $2d+1$.

\subsection{CRC (Cyclic Redundancy Check)}
Vengono visti i bit, \textit{D}, come un numero binario. Viene scelto un polinomio generatore di grado $r+1$ (una sequenza binaria in cui il primo elemento è sempre 1). L'obiettivo è trovare un numero \textit{r} di bits \textit{CRC} di ridondanza \textit{R}: viene calcolato così che $<D,R>$ (concatenazione) sia esattamente divisibile per \textit{G} (in modulo 2). Il ricevente conosce \textit{G}, e divide $<D^1,R^1>$ per \textit{G} e controlla che il resto di questa operazione sia proprio 0, il che gli garantisce che l'informazione non contenga errori. \\
Questo approccio è molto utilizzato in internet.

\section{Protocolli di accesso multiplo}
Due tipologie di link:
\begin{itemize}
	\item \textit{punto-punto} (sorgente-destinazione): due nodi collegati da un link link (come nel caso dei \textit{dialup PPP} e \textit{link ethernet}). Nessun rischio di collisione;
	\item \textit{broadcast}: il mezzo trasmissivo viene condiviso tra più nodi (come nel vecchio ethernet con topologia a \textit{bus}, nell'\textit{HFC}, nelle reti satellitari e nell \textit{802.11 wirelless} - wifi). Aperto a rischio di collissioni.
\end{itemize}
Se tutti i nodi sono liberi di contattare un mezzo trasmittivo, ci si apre al rischio di eventuali collisioni, motivo per cui è necessario introdurre delle regole. Occorre inoltre gestire il problema delle diverse potenze di trasmissione, noto come \textit{capture effect}: se c'è una grossa differenza di potenza tra due trasmissioni distinte, quello che trasmette con minore potenza non compromette completamente il primo; infatti, la sua trasmissione diventa sostanzialmente un \textit{rumore di fondo}, nonostante potrebbe rappresentare un caso di collisione.

\subsection{Mezzo condiviso}
Un protocollo di accesso multpilo è un protocollo che regolamenta l'utilizzo del mezzo trasmissivo per evitare fenomeni di collisione. \\
Le caratteristiche desiderabili sarebbero:
\begin{itemize}
	\item Data un'unica stazione di trasmissione, questa possa avere il massimo della capacità trasmissiva;
	\item Dato un numero variabile di nodi, questi possano avere una distribuzione equa della potenza di trasmissione dedicata a ciascuno;
	\item Un approccio decentralizzato: non voglio ci sia un elemento a coordinare la trasmissione e che non ci sia la necessità di sincronizzazione di orologi (perché ha un costo);
	\item Sia il più semplice possibile.
\end{itemize}
Protocolli MAC effettivamente proposti:
\begin{itemize}
	\item \textit{Channel Partitioning}: si divide il canale in sezioni, ognuna dedicata a ciascun nodo
	\begin{itemize}
		\item \textit{TDMA} (\textit{Time Division Multiple Access}): dispositivi hanno una visione comune del tempo, diviso in \textit{trame} (divise in tanti slot quanti sono i nodi che possono utilizzare la stessa stazione di trasmissione). All'interno del tempo di trama viene data la possibilità a un nodo di trasmettere con uno slot di una trama. Richiede sincronizzazione e occorre una porzione di banda detta \textit{banda di guardia}, utilizzata per separare le date sezioni;
		\item \textit{FDMA} (\textit{Frequency Division Multiple Access}): la banda viene divisa in tante sezioni quanti sono gli utenti, in modo tale che ciascuno abbia le sue risorse, ma equa capacità di banda. 
	\end{itemize}
	Sicuramente si tratta in entrambi i casi di una divisione equa, una soluzione - non ideale - di struttura decentralizzata e i protocolli sono semplici, ma non è possibile trasmettere a potenza massima 
	\item \textit{Random Access}: non diviso, permette collisioni:
	\begin{itemize}
		\item \textit{Slotted ALOHA}: la trasmissione viene divisa in frame di tempo uguali, ancora divisi in slot; se due o più nodi trasmettono in uno stesso slot, si verifica una collisione. Se si tratta di un frame pulito (nuovo, ancora inutilizzato), si trasmette nel primo slot: se c'è una collisione, si trasmette nel primo slot del prossimo frame. Mentre quando si tramsette lo si fa a potenza massima e per quanto si tratti di un algoritmo semplice, è soltanto parzialmente efficace, perché si verificano troppo spesso collisioni e troppo tempo viene speso senza effettiva trasmissione. Secondo un'analisi sull'efficienza, nel caso migliore, trasmette nel 37\% del tempo.
		\item \textit{Pure (unslotted) ALOHA}: se c'è qualcosa da trasmettere, viene fatto senza precauzioni, per un arco di tempo fisso. Se si presenta una collisione aspetto un arco di tempo fisso e poi avviene un nuovo tentativo. Il problema è che, mentre non c'è più sincronizzazione sulla cadenza tra uno slot e l'altro, si presenta però una sovrapposizione tra trasmissioni di diversi nodi. In questo caso, secondo un'analisi sull'efficienza, risulta trasmettere - nel caso migliore - nel 18\% del tempo.
		\item \textit{CSMA} (\textit{Carrier Sense Multiple Access}): una nuova estensione dell'\textit{ALOHA}. In questo caso, prima di trasmettere si verifica che non ci sia nessun altro nodo in trasmissione. Se così fosse, si ritarda la trasmissione. Ovviamente una collissione si può comunque verificare a causa del tempo di propagazione: si tratta del caso in cui qualcun altro comincia a trasmettere nell'intervallo di tempo che intercorre tra il controllo che il mezzo trasmissivo sia in \textit{idle state} (quindi nessuno sta trasmettendo) e l'effettivo invio dei dei dati da trasmettere. Si tratta di una probabilità di collissione molto più bassa.
		\item \textit{CSMA/CD} (\textit{Carrier Sense Multiple Access con Collision Detection}): si sta in ascolto se qualcuno sta già trasmettendo (\textit{carrier sensing}). Sostanzialmente, si ascolta per verificare che non ci siano eventuali collisioni, e in tal caso si provvede immediatamente a stoppare la trasmissione e ritardarla. Il tempo di tra un abort di trasmissione a causa di una collisione e una nuova trasmissione viene scelto randomicamente selezionando in un intervallo tra in $0$ e $2^{m-1}$, dove \textit{m} è il numero di ritrasmissione, in modo tale che per ogni ritrasmissione, il tempo di \textit{wait} raddoppi, rispetto all'ultima \textit{wait}. L'efficienza del protocollo \textit{CSMA} è tanto più bassa quanto più è alto il tempo di propagazione: decisamente più performante dell'\textit{ALOHA}, più semplilce e decentralizzato.
	\end{itemize}
	\item \textit{Taking Turns}: a turni, ogni nodo può accedere alla stazione trasmissiva (alcuni potrebbero tenere occupata la stazione più tempo). Si tratta di un approccio a \textit{polling}: c'è un \textit{master node} che gestisce la coda degli \textit{slave nodes}, per trasmettere - a turno - quanto da loro desiderato.
\end{itemize}

\paragraph{MAC e ARP}
A differenza dell'indirizzo \textit{IP}, l'indirizzo \textit{MAC} è fisso, perché tipicamente scritto direttamente nell'adattatore di rete utilizzato e si tratta di una sequenza a 48 bit. Viene utilizzato perché possa non esistere alcuna corrispondenza tra l'indirizzo \textit{MAC} e la rete a cui l'adattatore risulta connesso, a differenza dell'indirizzo \textit{IP}. Tutto ciò per rendere il nodo di rete quanto più unicamente qualificabile e rintracciabile in una qualsiasi rete, a prescindere dalla rete stessa. \\
L'allocazione dell'indirizzo \textit{MAC} è gestita da \textit{IEEE}: ogni società manufatturiera compra una porzione di indirizzo \textit{MAC} per garantirgli l'unicità. \\
Questo indirizzo viene utilizzato nel livello di rete per raggiungere - da una sorgente - una destinazione. Per fare questo viene utilizzato il protocollo \textit{ARP} (\textit{Address Resolution Protocol}): ogni dispotivio nell'adattatore mantiete una \textit{ARP Table}, che associa ogni indirizzo \textit{IP} al corrispettivo indirizzo \textit{MAC} per ciascun nodo di rete, secondo la tripla: $<ip;mac;ttl>$ (la \textit{TTL} è tipicamente settata a 20 minuti). Qualora la \textit{ARP Table} non contenga l'associazione dell'\textit{IP} che ho la necessità di contattare, viene eseguita una \textit{query ARP} in \textit{broadcast} sulla \textit{LAN}: la risposta ottenuta viene salvata nella cache (per un tempo massimo definito dalla \textit{TTL} definita nella tripla ottenuta). \\
Per ogni adattatore di rete in un nodo viene conservata una \textit{ARP Table} diversa.

\section{Ethernet}
Nei primi anni, veniva utilizzata la \textit{topologia a bus}: i nodi si trovavano tutti nello stesso dominio di collisione (potendo, quindi, collidere ciascuno con l'altro). Col passare del tempo è stata introdotta una struttura topologica migliore, la \textit{topologia a stella}: vi è uno switch al centro, che lega tutte le interfaccie di ciascun nodo a sé stesso, utilizzando un canale separato per ciascuno ed evitando quindi eventuali collisioni tra i vari nodi. \\
La struttura di una trama Ethernet è semplicissima:
\begin{itemize}
	\item \textit{preamble} (da 7 byte): utilizzato per garantire la sincronizzazione tra trasmettitore e ricevitore;
	\item \textit{indirizzo sorgente} e \textit{indirizzo destinazione}: indirizzi \textit{MAC}, estremi della trasmissione;
	\item \textit{type}: indica il protocollo da utilizzare nel livello superiore (generalmente \textit{IP}, ma possibili molti altri: e.g. \textit{Novel IPX}, \textit{AppleTalk}, \ldots);
	\item \textit{crc}: campo per detecting di errori ad opera del ricevitore (se vengono trovati errori, il frame viene scartato).
\end{itemize}
Ethernet è \textit{connectionless}, \textit{unreliable} e utilizza l'algoritmo \textit{CSMA/CD}.